# fee_engine

## Користена технологија:
- Java 17
- Spring Boot 
- Maven
- SQLite db 
- Swagger UI за тестирање на API

## Преглед
Овој проект е имплементација на Fee Calculation Engine кој користи систем на правила на динамично пресметување тарифи
според различни атрибути на трансакциите и клиентите.

## Функционалности
- Пресметка на надомест за поединечна трансакција
- Поддршка за batch обработка на повеќе трансакции 
- Историја на пресметки 
- Динамички систем на правила

## Архитектура 

# dto
- RuleResult e dto објект за чување на вкупниот надомест (totalFee) и имиња на применетите правила (appliedRules)
# model
- Client ентитет кој ги претставува клиентите во базата преку табела со информации за име, credit score, сегмент и id и 
се користи за поврзување трансакции со одреден клиент
- FeeCalculationHistory е jpa ентитет кои се користи за евиденција на извршени трансакции
- Rule е jpa ентитет, правило за пресметка на надоместоци со име, опис, услов, тип и акција и служи за динамичко 
управување со логиката на тарифи
- Transactions е jpa ентитет со податоци за тип, износ, валута, дали е мегународна, клиент, credit score и fee за дадена 
трансакција.
# repository
- Служат за пристап до базата на податоци со CRUD операции од секој repository за секој ентитет.
# ruleengine
FeeRule е интерфејс кој дефинира три методи за пресметка на надоместоци.
RuleEngine го користиме како динамичка примена на правила со пресметка на надоместоци. Ги вчитува сите правила од базата, 
за секое правило го проверува условот со Spring Expression Language преку податок од трансакцијата. 
Ако условот важи, се извршува акцијата која враќа износ на надомест, ги собира сите такси од totalFee и на крај враќа објект
со вкупниот надомест и листа на применети правила.
Со оваа имплементација правилата се динамички и лесни за промена без да мора да го менуваме кодот.
# Правила:
- CreditScoreDiscountRule e класа (правило) што се применува ако трансакцијата е од клиент со credit score >= 700 и 
намалува fee за 0,25
- ECommerceRule e правило кое се применува само на трансакции од типот ECommerce и додава фиксна такса од 0,50.
- FixedFeeRule секогаш се применува и додава фиксна такса од 1,00 на секоја трансакција безразлика на типот.
# service
Ја содржат бизнис логиката и ги поврзуваат контролерите со repositories за четирите главни ентитети
- ClientServiceImpl: пребарување и зачувување 
- HistoryServiceImpl: чување и пребарување според id 
- RuleServiceImpl: пребарување, додавање, ажурирање и бришење на правила
- TransactionServiceImpl: управува со трансакции и користи RuleEngine за пресметка на надоместоците според правила
# web controllers
- HistoryController ни овозможува пристап до историја на пресметка на таксите и ги враќа сите записи.
- RuleController управува со правила за пресметка (креира, ажурира и брише правила преку REST API).
- ТransactionController пресметува надоместоци за трансакции

# Ако имав повеќе време
- Во моментот правилата се компоненти и се скенираат при стартување. За runtime менување би се пренасочила на динамичко читање
- SQLite го избрав поради лесната конфигурација, доколку требаше да се пушта во продукција, би користела посигурен RDBMS
- Би додала UI 
- Би имплементирала кеширање на чести клиенти 
- Би подобрила логирање и tracing за batch performance